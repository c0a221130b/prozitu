#include <stdio.h>
#include <stdlib.h>

int main(void) {
    FILE* fp = fopen("./victim/a.txt", "rb+");

    if(fp == NULL) {
        fputs("File cannot open.\n", stderr);
        exit(1);
    }

    int tmp_r;

    while(fread(&tmp_r, sizeof(tmp_r), 1, fp) > 0) {
        printf( "%d\n", tmp_r);
        fseek(fp, -sizeof(tmp_r), SEEK_CUR);
        int key = 9876543;
        int tmp_w = tmp_r ^ key;
        fwrite(&tmp_w, sizeof(key), 1, fp);
        printf( "%d\n", tmp_w);
    }

    rewind(fp);

    while(fread(&tmp_r, sizeof(tmp_r), 1, fp) > 0) {
        printf( "%d\n", tmp_r);
        fseek(fp, -sizeof(tmp_r), SEEK_CUR);
        int key = 9876543;
        int tmp_w = tmp_r ^ key;
        fwrite(&tmp_w, sizeof(key), 1, fp);
        printf( "%d\n", tmp_w);
    }

    fclose(fp);

    return 0;
}